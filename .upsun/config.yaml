applications:
  frontend:
    type: nodejs:20
    source:
      root: "frontend"
    build:
      flavor: none
    hooks:
      build: |
        npm ci
        npm run build
        # Dodajte provjeru builda
        if [ ! -d "dist" ]; then
          echo "‚ùå Build failed - no dist directory"
          exit 1
        fi
        echo "‚úÖ Build successful"
    web:
      locations:
        "/":
          root: "dist"  # üëà KLJUƒåNO: dodajte ovo!
          index: ["index.html"]
          expires: -1
          allow: true
          scripts: true
          passthru: true
        "/assets":
          root: "dist/assets"
          expires: 1y
          allow: true

  backend:
    type: nodejs:20
    source:
      root: "backend"
    build:
      flavor: none
    hooks:
      build: |
        npm ci
    web:
      commands:
        start: "node server.js"
    relationships:
      database:
        service: postgresql
        endpoint: postgresql

services:
  postgresql:
    type: postgresql:15

routes:
  "https://{default}/":
    type: upstream
    upstream: "frontend:http"
  "https://{default}/api/":
    type: upstream
    upstream: "backend:http"