[build]
builder = "nixpacks"

[deploy]
startCommand = "npm run db:setup && npm start"
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 3

[deploy.branches]
only = ["staging"]

[[services]]
name = "web"
run = "npm start"

[[services]]
name = "database"
type = "postgresql"
plan = "hobby"

[environments.production.variables]
NODE_ENV = "production"
PORT = "3001"

[environments.staging.variables] 
NODE_ENV = "production"
PORT = "3001"
