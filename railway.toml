[build]
builder = "nixpacks"
buildCommand = "cd backend && npm install"

[deploy]
startCommand = "cd backend && npm start"
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

# ðŸ‘‡ DEPLOY BOTH BRANCHES TO DIFFERENT ENVIRONMENTS
branches = ["staging", "development"]

[[services]]
name = "web"
run = "cd backend && npm start"

# Staging Environment (staging branch)
[environments.staging]
branch = "staging"
variables = { 
    NODE_ENV = "staging", 
    PORT = "3001",
    APP_BRANCH = "staging"
}

# Development Environment (development branch)  
[environments.development]
branch = "development"
variables = { 
    NODE_ENV = "development", 
    PORT = "3001",
    APP_BRANCH = "development"
}
